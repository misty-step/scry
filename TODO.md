# TODO

- [x] Add Convex regression tests for `convex/concepts.ts`, `questionsCrud.ts`, `questionsBulk.ts`, and `embeddings.ts` (cover create/update/delete branches, pagination, empty inputs, embedding failure paths) using existing helpers in `tests/helpers`; success criteria: `pnpm test:coverage` reports `convex/**/*` lines/functions ≥25% with no new flakes.
- [x] Add hook tests for `hooks/use-review-flow.ts`, `use-keyboard-shortcuts.ts`, `use-button-press.ts`, and `use-confirmation.tsx` capturing debounce, cancel, and error branches with happy-dom; success criteria: global coverage rises to ≥27% lines/statements without exceeding 6s per file.
- [x] Ratchet Vitest thresholds in `vitest.config.ts` to lines/statements 27%, functions 26%, branches 22%, and `convex/**/*` 25%; align comments to new floor/target numbers; success criteria: suite passes locally and fails when coverage regresses below these floors.
- [x] Create `.codecov.yml` with project status floors matching Vitest (lines/statements 27%, functions 26%, branches 22%) and patch status at 80% (tolerate 1% delta); success criteria: Codecov status fails PRs below floors and PR comment shows project + patch summaries only.
- [x] Update `.github/workflows/ci.yml` test job: timeout ≥8m, keep `pnpm test:ci`, set Codecov step `fail_ci_if_error: true`; success criteria: CI fails if coverage upload or status fails, job completes under new timeout on current suite.
- [~] Tag Playwright smoke scenarios (add `@smoke` to fastest path in `tests/e2e/spaced-repetition.test.ts`) and add npm script `test:e2e:smoke` invoking `npx playwright test --grep @smoke --project=chromium`; success criteria: smoke run <2m against `PLAYWRIGHT_BASE_URL`, exits nonzero on failures.
- [x] Extend `.github/workflows/preview-smoke-test.yml` to run Playwright smoke against the preview URL after the wait step, exporting `PLAYWRIGHT_BASE_URL`; upload trace/video artifacts on failure; success criteria: job fails on assertion errors, passes in <6m when preview healthy.
- [ ] Add scheduled workflow `nightly-e2e.yml` that runs full Playwright suite (`tests/e2e/**`) plus `pnpm test:coverage` and uploads reports/artifacts; success criteria: completes with retries disabled, serial workers on CI, artifacts retained 7 days.
- [ ] Update `lefthook.yml` pre-push to run a fast coverage gate (e.g., `pnpm test --run --changed --coverage=false` followed by `pnpm test:coverage --run tests/convex/**/*.test.ts --run hooks/**/*.test.ts` or similar minimal set) keeping runtime <3m; success criteria: hook blocks pushes on failing or missing targeted tests but remains opt-out via standard Lefthook skip env.
- [ ] Add scoped test scripts to `package.json` (`test:unit`, `test:integration`, `test:e2e:full`, `test:e2e:smoke`) routing to Vitest/Playwright with consistent flags; success criteria: scripts used in CI/hook definitions without duplication.
- [ ] Refresh docs in `tests/README.md` and `docs/guides/testing-convex.md` to match actual browser matrix (Chromium + Mobile Chrome), new commands, threshold numbers, and lanes (fast CI vs nightly); success criteria: instructions runnable verbatim on a clean checkout.
- [ ] Add README coverage badges for project and patch status using Codecov URLs pinned to `branch=main` and new Codecov config; success criteria: badges render and update after CI uploads.
