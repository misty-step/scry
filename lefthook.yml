# Lefthook Git Hooks Configuration
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    # TypeScript type checking to catch compilation errors early
    typecheck:
      glob: "*.{ts,tsx}"
      run: pnpm exec tsc --noEmit
      fail_text: "TypeScript compilation failed. Fix type errors before committing."

    # Lint and format staged files
    lint-staged:
      run: pnpm exec lint-staged
      fail_text: "Linting or formatting failed. Check eslint and prettier output."

pre-push:
  parallel: false
  commands:
    # Comprehensive TypeScript check before pushing
    typecheck:
      run: pnpm exec tsc --noEmit
      fail_text: "TypeScript compilation failed. Cannot push with type errors."

    # Fast unit regression check on changed files (no coverage)
    test-unit-changed:
      run: ./scripts/test-changed-batches.sh
      fail_text: "Unit tests (changed files) failed. Fix before pushing."

    # Targeted coverage gate for core domains (convex + hooks)
    test-coverage-core:
      run: SKIP_HEAVY_TESTS=1 NODE_OPTIONS=--max-old-space-size=4096 pnpm test:coverage -- --run --pool=forks --maxWorkers=1 tests/convex/**/*.test.ts hooks/**/*.test.ts
      fail_text: "Coverage gate failed (convex/hooks)."
